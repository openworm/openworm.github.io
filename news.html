<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>OpenWorm News</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="OpenWorm News - Recent updates from the project">

  <!-- REPLICATE THIS IN ALL PAGES -->

  <!-- Le styles -->
  <link href="css/bootstrap.css" rel="stylesheet">
  <link rel="stylesheet" href="css/font-awesome.css">
  <link href="css/bootstrap-responsive.css" rel="stylesheet">
  <link href="css/main.css" rel="stylesheet">
  <link href="css/docs.css" rel="stylesheet">

  <!-- Fav and touch icons - this code is outdated -->
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">

  <div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner" id="head-nav">
    </div>
  </div>
  <script src="js/jquery-3.6.0.js"></script>
  <script>
    // get head-nav and foot-nav with jquery (get is async)
    $.get('header-content.html', function(data) {
      $('#head-nav').html(data);
    })
    $.get('footer-content.html', function(data) {
      $('#foot-nav').html(data);
    })
  </script>
</head>

<body>
  <div id="pjax-content">
    <!-- END REPEAT-->

    <header class="jumbotron subhead" id="overview">
      <div class="container">
        <!--<div class="openworm_logo_header"></div>-->
        <h1>OpenWorm News</h1>
        <p class="lead">
          Recent updates from the OpenWorm project
        </p>
        <p>
          <a href="https://openworm.tumblr.com" target="_blank">View full blog on Tumblr &raquo;</a>
        </p>
      </div>
    </header>

    <div class="container">

      <div class="row">
        <div class="span12">

          <div class="page-header">
            <h2>Latest News</h2>
            <p class="muted">News items are pulled from our <a href="https://openworm.tumblr.com" target="_blank">Tumblr blog</a>.</p>
          </div>

          <!-- Dynamic news feed from Tumblr RSS -->
          <ul id="news-feed-full" style="list-style-type: none; margin-left: 0;">
            <li style="text-align: center; padding: 40px;">
              <i class="fa fa-spinner fa-spin fa-3x"></i>
              <p class="muted">Loading news from Tumblr...</p>
            </li>
          </ul>

        </div>
      </div>

    </div>

    <!-- FOOT: DUPLICATE THE FOLLOWING IN ALL PAGES -->
  </div><!-- end pjax content -->

  <!-- footer
       ================================================== -->
  <div id="foot-nav"></div>

  <!-- Le javascript
       ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="js/bootstrap.js"></script>
  <script>
    // Load full news feed from Tumblr RSS using allOrigins CORS proxy
    $(function() {
      $.ajax({
        url: 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://openworm.tumblr.com/rss'),
        method: 'GET',
        dataType: 'json',
        success: function(data) {
          var parser = new DOMParser();
          var xml = parser.parseFromString(data.contents, 'text/xml');
          var items = xml.querySelectorAll('item');

          var html = '';
          var count = 0;
          items.forEach(function(item) {
            if (count >= 25) return;

            var title = item.querySelector('title').textContent;
            var link = item.querySelector('link').textContent;
            var pubDate = new Date(item.querySelector('pubDate').textContent);
            var dateStr = pubDate.toLocaleDateString('en-US', {
              month: 'long',
              day: 'numeric',
              year: 'numeric'
            });

            // Get description/content
            var descNode = item.querySelector('description');
            var description = descNode ? descNode.textContent : '';

            var borderStyle = (count < 24) ? 'border-bottom: 1px solid #eee;' : '';

            html += '<li style="margin-bottom: 30px; padding-bottom: 20px; ' + borderStyle + '">';
            html += '<h3 style="margin-top: 0;"><a href="' + link + '" target="_blank">' + title + '</a></h3>';
            html += '<p class="muted" style="font-size: 14px; margin-bottom: 10px;">' + dateStr + '</p>';
            html += '<div style="line-height: 1.6;">' + description + '</div>';
            html += '</li>';
            count++;
          });

          $("#news-feed-full").html(html);

          // Make images responsive
          $("#news-feed-full img").css({
            "max-width": "100%",
            "height": "auto",
            "margin": "15px 0",
            "display": "block"
          });
        },
        error: function(err) {
          console.error('Error loading news feed:', err);
          $("#news-feed-full").html('<li class="muted" style="text-align: center; padding: 40px;">Unable to load news feed. Please try again later.</li>');
        }
      });
    });
  </script>

</body>

</html>
